# Bing Web検索クライアントサーバへの研究室クラスターへのデプロイ

## 前提

- [Bing Web検索クライアントサーバ](1-install.md)
  - Azureの`SUBSCRIPTION_KEY`と`ENDPOINT`
- Docker Hubアカウントd
- 研究室Jupyter Notebook
  - `hideojoho/jupyter-kubectl`イメージ

## 手順

- クライアントサーバアプリの作成
- Dockerイメージの作成とテスト
- Docker Hubへのアップロード
- k8s設定ファイルの作成と実行
- [Jupyter Notebookからのアクセス](../../k8s/ipynb/bingsearch.ipynb)


### Dockerイメージの作成とテスト

- イメージ作成

```
$ docker build -t YOUR-DOCKERHUB-USERNAME/k8s-bingsearch .
```

- テスト

```
```

### Docker Hubへのアップロード

- アップロード

```
$ docker push YOUR-DOCKERHUB-USERNAME/k8s-bingsearch
```

###  k8s設定ファイルの作成と実行

- 研究室クラスターからJupyter Notebookを起動（イメージ：`hideojoho/jupyter-kubectl`）
- 設定ファイル`my-bingsearch.yaml`の新規作成

```
apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2
kind: Deployment
metadata:
  name: bingsearch
spec:
  selector:
    matchLabels:
      run: bingsearch
      app: bingsearch
  template:
    metadata:
      labels:
        run: bingsearch
        app: bingsearch
    spec:
      containers:
      - name: bingsearch
        image: YOUR-DOCKERHUB-USERNAME/k8s-bingsearch // Change here or use 'hideojoho/k8s-bingsearch'
        ports:
        - containerPort: 5000
        env:
        - name: AZURE_SUBSCRIPTION_KEY
          value: "YOUR-AZURE_SUBSCRIPTION_KEY" // Change here
        - name: AZURE_ENDPOINT
          value: "YOUR-AZURE_ENDPOINT" // Change here
---
apiVersion: v1
kind: Service
metadata:
  name: bingsearch
  labels:
    run: bingsearch
spec:
  ports:
  - port: 5000
    targetPort: 5000
    protocol: TCP
  selector:
    run: bingsearch
```
